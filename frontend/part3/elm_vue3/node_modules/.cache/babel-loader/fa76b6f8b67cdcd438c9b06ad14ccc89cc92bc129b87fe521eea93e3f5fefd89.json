{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nexport default {\n  name: 'Orders',\n  data() {\n    return {\n      businessId: this.$route.query.businessId,\n      business: {},\n      user: {},\n      cartArr: [],\n      deliveryaddress: {}\n    };\n  },\n  created() {\n    this.user = this.$getSessionStorage('user');\n    this.deliveryaddress = this.$getLocalStorage(this.user.userId);\n\n    //查询当前商家\n    this.$axios.post('BusinessController/getBusinessById', this.$qs.stringify({\n      businessId: this.businessId\n    })).then(response => {\n      this.business = response.data;\n    }).catch(error => {\n      console.error(error);\n    });\n\n    //查询当前用户在购物车中的当前商家食品列表\n    this.$axios.post('CartController/listCart', this.$qs.stringify({\n      userId: this.user.userId,\n      businessId: this.businessId\n    })).then(response => {\n      this.cartArr = response.data;\n    }).catch(error => {\n      console.error(error);\n    });\n  },\n  computed: {\n    totalPrice() {\n      let totalPrice = 0;\n      for (let cartItem of this.cartArr) {\n        totalPrice += cartItem.food.foodPrice * cartItem.quantity;\n      }\n      totalPrice += this.business.deliveryPrice;\n      return totalPrice;\n    }\n  },\n  filters: {\n    sexFilter(value) {\n      return value == 1 ? '先生' : '女士';\n    }\n  },\n  methods: {\n    toUserAddress() {\n      this.$router.push({\n        path: '/userAddress',\n        query: {\n          businessId: this.businessId\n        }\n      });\n    },\n    toPayment() {\n      if (this.deliveryaddress == null) {\n        alert('请选择送货地址！');\n        return;\n      }\n\n      //创建订单\n      this.$axios.post('OrdersController/createOrders', this.$qs.stringify({\n        userId: this.user.userId,\n        businessId: this.businessId,\n        daId: this.deliveryaddress.daId,\n        orderTotal: this.totalPrice\n      })).then(response => {\n        let orderId = response.data;\n        if (orderId > 0) {\n          this.$router.push({\n            path: '/payment',\n            query: {\n              orderId: orderId\n            }\n          });\n        } else {\n          alert('创建订单失败！');\n        }\n      }).catch(error => {\n        console.error(error);\n      });\n    }\n  }\n};","map":{"version":3,"names":["name","data","businessId","$route","query","business","user","cartArr","deliveryaddress","created","$getSessionStorage","$getLocalStorage","userId","$axios","post","$qs","stringify","then","response","catch","error","console","computed","totalPrice","cartItem","food","foodPrice","quantity","deliveryPrice","filters","sexFilter","value","methods","toUserAddress","$router","push","path","toPayment","alert","daId","orderTotal","orderId"],"sources":["C:\\Users\\。。。\\Desktop\\neosoft\\myvue\\elmclient\\src\\views\\Orders.vue"],"sourcesContent":["<template>\r\n\t<div class=\"wrapper\">\r\n\t\t<!-- header部分 -->\r\n\t\t<header>\r\n\t\t\t<p>确认订单</p>\r\n\t\t</header>\r\n\t\t<!-- 订单信息部分 -->\r\n\t\t<div class=\"order-info\">\r\n\t\t\t<h5>订单配送至：</h5>\r\n\t\t\t<div class=\"order-info-address\" @click=\"toUserAddress\">\r\n\t\t\t\t<p>{{deliveryaddress!=null?deliveryaddress.address:'请选择送货地址'}}</p>\r\n\t\t\t\t<i class=\"fa fa-angle-right\"></i>\r\n\t\t\t</div>\r\n\t\t\t<p>{{user.userName}}{{user.userSex | sexFilter}} {{user.userId}}</p>\r\n\t\t</div>\r\n\t\t<h3>{{business.businessName}}</h3>\r\n\t\t<!-- 订单明细部分 -->\r\n\t\t<ul class=\"order-detailed\">\r\n\t\t\t<li v-for=\"item in cartArr\">\r\n\t\t\t\t<div class=\"order-detailed-left\">\r\n\t\t\t\t\t<img :src=\"item.food.foodImg\">\r\n\t\t\t\t\t<p>{{item.food.foodName}} x {{item.quantity}}</p>\r\n\t\t\t\t</div>\r\n\t\t\t\t<p>&#165;{{item.food.foodPrice*item.quantity}}</p>\r\n\t\t\t</li>\r\n\t\t</ul>\r\n\t\t<div class=\"order-deliveryfee\">\r\n\t\t\t<p>配送费</p>\r\n\t\t\t<p>&#165;{{business.deliveryPrice}}</p>\r\n\t\t</div>\r\n\t\t<!-- 合计部分 -->\r\n\t\t<div class=\"total\">\r\n\t\t\t<div class=\"total-left\">\r\n\t\t\t\t&#165;{{totalPrice}}\r\n\t\t\t</div>\r\n\t\t\t<div class=\"total-right\" @click=\"toPayment\">\r\n\t\t\t\t去支付\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t</div>\r\n</template>\r\n<script>\r\n\texport default {\r\n\t\tname: 'Orders',\r\n\t\tdata() {\r\n\t\t\treturn {\r\n\t\t\t\tbusinessId: this.$route.query.businessId,\r\n\t\t\t\tbusiness: {},\r\n\t\t\t\tuser: {},\r\n\t\t\t\tcartArr: [],\r\n\t\t\t\tdeliveryaddress: {}\r\n\t\t\t}\r\n\t\t},\r\n\t\tcreated() {\r\n\t\t\tthis.user = this.$getSessionStorage('user');\r\n\t\t\tthis.deliveryaddress = this.$getLocalStorage(this.user.userId);\r\n\r\n\t\t\t//查询当前商家\r\n\t\t\tthis.$axios.post('BusinessController/getBusinessById', this.$qs.stringify({\r\n\t\t\t\tbusinessId: this.businessId\r\n\t\t\t})).then(response => {\r\n\t\t\t\tthis.business = response.data;\r\n\t\t\t}).catch(error => {\r\n\t\t\t\tconsole.error(error);\r\n\t\t\t});\r\n\r\n\t\t\t//查询当前用户在购物车中的当前商家食品列表\r\n\t\t\tthis.$axios.post('CartController/listCart', this.$qs.stringify({\r\n\t\t\t\tuserId: this.user.userId,\r\n\t\t\t\tbusinessId: this.businessId\r\n\t\t\t})).then(response => {\r\n\t\t\t\tthis.cartArr = response.data;\r\n\t\t\t}).catch(error => {\r\n\t\t\t\tconsole.error(error);\r\n\t\t\t});\r\n\t\t},\r\n\t\tcomputed: {\r\n\t\t\ttotalPrice() {\r\n\t\t\t\tlet totalPrice = 0;\r\n\t\t\t\tfor (let cartItem of this.cartArr) {\r\n\t\t\t\t\ttotalPrice += cartItem.food.foodPrice * cartItem.quantity;\r\n\t\t\t\t}\r\n\t\t\t\ttotalPrice += this.business.deliveryPrice;\r\n\t\t\t\treturn totalPrice;\r\n\t\t\t}\r\n\t\t},\r\n\t\tfilters: {\r\n\t\t\tsexFilter(value) {\r\n\t\t\t\treturn value == 1 ? '先生' : '女士';\r\n\t\t\t}\r\n\t\t},\r\n\t\tmethods: {\r\n\t\t\ttoUserAddress() {\r\n\t\t\t\tthis.$router.push({\r\n\t\t\t\t\tpath: '/userAddress',\r\n\t\t\t\t\tquery: {\r\n\t\t\t\t\t\tbusinessId: this.businessId\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t},\r\n\t\t\ttoPayment() {\r\n\t\t\t\tif (this.deliveryaddress == null) {\r\n\t\t\t\t\talert('请选择送货地址！');\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t//创建订单\r\n\t\t\t\tthis.$axios.post('OrdersController/createOrders', this.$qs.stringify({\r\n\t\t\t\t\tuserId: this.user.userId,\r\n\t\t\t\t\tbusinessId: this.businessId,\r\n\t\t\t\t\tdaId: this.deliveryaddress.daId,\r\n\t\t\t\t\torderTotal: this.totalPrice\r\n\t\t\t\t})).then(response => {\r\n\t\t\t\t\tlet orderId = response.data;\r\n\t\t\t\t\tif (orderId > 0) {\r\n\t\t\t\t\t\tthis.$router.push({\r\n\t\t\t\t\t\t\tpath: '/payment',\r\n\t\t\t\t\t\t\tquery: {\r\n\t\t\t\t\t\t\t\torderId: orderId\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\talert('创建订单失败！');\r\n\t\t\t\t\t}\r\n\t\t\t\t}).catch(error => {\r\n\t\t\t\t\tconsole.error(error);\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n</script>\r\n<style scoped>\r\n\t/****************** 总容器 ******************/\r\n\t.wrapper {\r\n\t\twidth: 100%;\r\n\t\tbackground-color: #f2f2f2;\r\n\t}\r\n\r\n\t/****************** header部分 ******************/\r\n\t.wrapper header {\r\n\t\twidth: 100%;\r\n\t\theight: 12vw;\r\n\t\tbackground-color: deepskyblue;\r\n\r\n\t\tposition: fixed;\r\n\t\ttop: 0;\r\n\t\tleft: 0;\r\n\r\n\t\tdisplay: flex;\r\n\t\tjustify-content: center;\r\n\t\talign-items: center;\r\n\r\n\t\tcolor: white;\r\n\t\tfont-size: 5vw;\r\n\t\tfont-weight: 700;\r\n\t}\r\n\r\n\t/****************** 订单信息部分 ******************/\r\n\t.wrapper .order-info {\r\n\t\t/*注意这里，不设置高，靠内容撑开。因为地址有可能折行*/\r\n\t\twidth: 100%;\r\n\t\tbox-sizing: border-box;\r\n\t\tpadding: 12vw 4vw 4vw;\r\n\r\n\t\tbackground-color: deepskyblue;\r\n\t\tcolor: white;\r\n\t\tborder-bottom-right-radius: 6vw;\r\n\t\tborder-bottom-left-radius: 6vw;\r\n\r\n\t\tuser-select: none;\r\n\t\tcursor: pointer;\r\n\t}\r\n\r\n\t.wrapper .order-info h5 {\r\n\t\tfont-size: 3vw;\r\n\t\tfont-weight: 400;\r\n\t}\r\n\r\n\t.wrapper .order-info .order-info-address {\r\n\t\twidth: 90%;\r\n\t\tdisplay: flex;\r\n\t\tjustify-content: space-between;\r\n\t\talign-items: center;\r\n\t\tfont-weight: 700;\r\n\t\tuser-select: none;\r\n\t\tcursor: pointer;\r\n\t\tmargin: 1vw 0;\r\n\t}\r\n\r\n\t.wrapper .order-info .order-info-address p {\r\n\t\twidth: 90%;\r\n\t\tfont-size: 5vw;\r\n\t}\r\n\r\n\t.wrapper .order-info .order-info-address i {\r\n\t\tfont-size: 6vw;\r\n\t}\r\n\r\n\t.wrapper .order-info p {\r\n\t\tfont-size: 3.5vw;\r\n\t}\r\n\r\n\t.wrapper h3 {\r\n\t\tbox-sizing: border-box;\r\n\t\tpadding: 3vw;\r\n\t\tfont-size: 4vw;\r\n\t\tcolor: #666;\r\n\t\tborder-bottom: solid 1px #DDD;\r\n\t}\r\n\r\n\t/****************** 订单明细部分 ******************/\r\n\t.wrapper .order-detailed {\r\n\t\twidth: 100%;\r\n\t}\r\n\r\n\t.wrapper .order-detailed li {\r\n\t\twidth: 100%;\r\n\t\theight: 16vw;\r\n\t\tbox-sizing:border-box;\r\n\t\tpadding: 3vw;\r\n\t\tmargin-top: 2vw;\r\n\t\tmargin-bottom: 2vw;\r\n\t\t\r\n\t\tcolor: gray;\r\n\t\tfont-size: 3.5vw;\r\n\t\t\r\n\t\tdisplay: flex;\r\n\t\tjustify-content: space-between;\r\n\t\talign-items: center;\r\n\t}\r\n\r\n\t.wrapper .order-detailed li .order-detailed-left {\r\n\t\tdisplay: flex;\r\n\t\talign-items: center;\r\n\t}\r\n\r\n\t.wrapper .order-detailed li .order-detailed-left img {\r\n\t\twidth: 12vw;\r\n\t\theight: 12vw;\r\n\t\tmargin-right: 3vw;\r\n\t}\r\n\r\n\t.wrapper .order-detailed li .order-detailed-left p {\r\n\t\tfont-size: 3.5vw;\r\n\t\tmargin-left: 3vw;\r\n\t}\r\n\r\n\t.wrapper .order-detailed li p {\r\n\t\tfont-size: 3.5vw;\r\n\t}\r\n\r\n\t.wrapper .order-deliveryfee {\r\n\t\twidth: 100%;\r\n\t\theight: 10vw;\r\n\t\tbox-sizing: border-box;\r\n\t\tpadding: 3vw;\r\n\t\tcolor: gray;\r\n\t\tdisplay: flex;\r\n\t\tjustify-content: space-between;\r\n\t\talign-items: center;\r\n\t\tfont-size: 3.5vw;\r\n\t}\r\n\r\n\t/****************** 订单合计部分 ******************/\r\n\t.wrapper .total {\r\n\t\twidth: 95%;\r\n\t\theight: 14vw;\r\n\t\tposition: fixed;\r\n\t\tbottom: 3vw;\r\n\t\tleft: 2.5vw;\r\n\t\tdisplay: flex;\r\n\t}\r\n\r\n\t.wrapper .total .total-left {\r\n\t\tbackground-color: dimgray;\r\n\t\tcolor: white;\r\n\t\tfont-size: 4.7vw;\r\n\t\tfont-weight: 700;\r\n\t\tborder-top-left-radius: 5vw;\r\n\t\tborder-bottom-left-radius: 5vw;\r\n\r\n\t\tdisplay: flex;\r\n\t\tflex: 2;\r\n\t\talign-items: center;\r\n\t\tjustify-content: center;\r\n\t}\r\n\r\n\t.wrapper .total .total-right {\r\n\t\tbackground-color: mediumseagreen;\r\n\t\tcolor: white;\r\n\t\tfont-size: 4.7vw;\r\n\t\tfont-weight: 700;\r\n\t\tborder-top-right-radius: 5vw;\r\n\t\tborder-bottom-right-radius: 5vw;\r\n\r\n\t\tdisplay: flex;\r\n\t\tflex: 1;\r\n\t\talign-items: center;\r\n\t\tjustify-content: center;\r\n\r\n\t\tcursor: pointer;\r\n\t\tuser-select: none;\r\n\t}\r\n</style>"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}